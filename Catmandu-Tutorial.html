<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Jakob Voß" />
  <meta name="date" content="(version rev0)" />
  <title>Catmandu Tutorial</title>
   <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
  body { font-family: sans-serif; }
  a { text-decoration: none }
  a:hover { text-decoration: underline }
  h1 { font: 170% sans-serif }
  h1.title { font-size: 200%; font-weight: bold; }
  h2 { font: 140% sans-serif }
  h3 { font: 120% sans-serif }
  dt { font-weight: bold; }
  h1, h2, h3, h1 a, h2 a, h3 a { color: #005A9C; }
  table { border-collapse: collapse; }
  td { border: 1px solid #999; padding: 3px }
  dl p { margin-top: 0; }
  dt { margin-top: 0.8em; }
  dd { margin-left: 1.5em; }
  ol { margin-bottom: 1em; }
  table + p { margin-top: 1em; }
  </style>
</head>
<body>
<header>
<h1 class="title">Catmandu Tutorial</h1>
<h3 class="author">Jakob Voß</h3>
<h4 class="date">(version rev0) (version rev0)</h4>
</header>

<h1>Table of Contents</h1>
<nav id="TOC">
<ul>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a></li>
<li><a href="#first-steps"><span class="toc-section-number">2</span> First steps</a><ul>
<li><a href="#the-command-line-client"><span class="toc-section-number">2.1</span> The command line client</a></li>
</ul></li>
<li><a href="#processing-data"><span class="toc-section-number">3</span> Processing data</a><ul>
<li><a href="#processing-xml-data"><span class="toc-section-number">3.1</span> Processing XML data</a><ul>
<li><a href="#importing-xml"><span class="toc-section-number">3.1.1</span> Importing XML</a><ul>
<li><a href="#first-steps-1"><span class="toc-section-number">3.1.1.1</span> First steps</a></li>
<li><a href="#ordered-xml"><span class="toc-section-number">3.1.1.2</span> Ordered XML</a></li>
</ul></li>
<li><a href="#exporting-xml"><span class="toc-section-number">3.1.2</span> Exporting XML</a></li>
<li><a href="#specific-xml-formats"><span class="toc-section-number">3.1.3</span> Specific XML formats</a></li>
</ul></li>
</ul></li>
<li><a href="#processing-pica-data"><span class="toc-section-number">4</span> Processing PICA data</a></li>
<li><a href="#acknowledgement"><span class="toc-section-number">5</span> Acknowledgement</a></li>
</ul>
</nav>
<section class="level1" id="introduction">
<h1><a href="#TOC"><span class="header-section-number">1</span> Introduction</a></h1>
<p><strong>Catmandu</strong> is a data processing toolkit developed as part of the LibreCat project. LibreCat is an open collaboration of the university libraries of Lund, Ghent, and Bielefeld. See the project’s website at <a href="http://librecat.org/"><code class="url">http://librecat.org/</code></a> for more information.</p>
<figure>
<img src="./img/librecat.png" title="LibreCat Logo" alt="the LibreCat logo"><figcaption>the LibreCat logo</figcaption>
</figure>
<p>Although Catmandu is implemented in the Perl programming language, one can make use of it without knowing Perl. The framework is shipped with a <a href="#the-command-line-client">command line client</a> and it contains a simple domain-specific language.</p>
</section>
<section class="level1" id="first-steps">
<h1><a href="#TOC"><span class="header-section-number">2</span> First steps</a></h1>
<section class="level2" id="the-command-line-client">
<a id="The command line client"></a><h2><a href="#TOC"><span class="header-section-number">2.1</span> The command line client</a></h2>
<p>The command line client <code>catmandu</code> is installed together with the Perl module <code>Catmandu</code>. Calling it without any arguments list the available commands:</p>
<pre class="cmd"><code>$ catmandu
    Available commands:

      commands: list the application&#39;s commands
          help: display a command&#39;s help screen

        config: print the Catmandu config as JSON
       convert: convert objects
         count: count the number of objects in a store
          data: store, index, search, import, export or convert objects
        delete: delete objects from a store
        export: export objects from a store
        import: import objects into a store
          move: move objects to another store</code></pre>
</section>
</section>
<section class="level1" id="processing-data">
<h1><a href="#TOC"><span class="header-section-number">3</span> Processing data</a></h1>
<section class="level2" id="processing-xml-data">
<a id="Processing XML data"></a><h2><a href="#TOC"><span class="header-section-number">3.1</span> Processing XML data</a></h2>
<p>To import and export XML data there is the module <a href="https://metacpan.org/module/Catmandu::XML">Catmandu::XML</a>. The following documentation requires at least version 0.03 of this module.</p>
<section class="level3" id="importing-xml">
<h3><a href="#TOC"><span class="header-section-number">3.1.1</span> Importing XML</a></h3>
<section class="level4" id="first-steps-1">
<h4><a href="#TOC"><span class="header-section-number">3.1.1.1</span> First steps</a></h4>
<p>Let’s start with the following XML file <code>input.xml</code>:</p>
<pre class="cmd"><code>$ cat data/input.xml
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;doc&gt;
  &lt;id&gt;1&lt;/id&gt;
  &lt;id&gt;2&lt;/id&gt;
  &lt;xx&gt;3&lt;/xx&gt;
  &lt;id&gt;4&lt;/id&gt;
&lt;/doc&gt;</code></pre>
<p>A simple conversion maps child elements of the root to hash elements:</p>
<pre class="cmd"><code>$ catmandu convert XML to JSON &lt; data/input.xml
{&quot;id&quot;:[&quot;1&quot;,&quot;2&quot;,&quot;4&quot;],&quot;xx&quot;:&quot;3&quot;}</code></pre>
<p>Option <code>--root</code> includes the root element:</p>
<pre class="cmd"><code>$ catmandu convert XML --root 1 to JSON &lt; data/input.xml
{&quot;doc&quot;:{&quot;id&quot;:[&quot;1&quot;,&quot;2&quot;,&quot;4&quot;],&quot;xx&quot;:&quot;3&quot;}}</code></pre>
<p>To only convert selected XML elements, use option <code>--path</code>:</p>
<pre class="cmd"><code>$ catmandu convert XML --path &#39;/*/id&#39; to JSON &lt; data/input.xml
{&quot;id&quot;:&quot;1&quot;}
{&quot;id&quot;:&quot;2&quot;}
{&quot;id&quot;:&quot;4&quot;}</code></pre>
<p>By using option <code>--path</code> you virtually select new root elements (element <code>id</code> in this example), so <code>--path</code> also enables <code>--root</code> by default. You can still disable root elements or choose another name:</p>
<pre class="cmd"><code>$ catmandu convert XML --path &#39;/doc/*&#39; --root a to JSON &lt; data/input.xml
{&quot;a&quot;:&quot;1&quot;}
{&quot;a&quot;:&quot;2&quot;}
{&quot;a&quot;:&quot;3&quot;}
{&quot;a&quot;:&quot;4&quot;}</code></pre>
<p>The default XML importer includes both, XML elements and XML attributes as key-value pairs:</p>
<pre class="cmd"><code>$ echo &#39;&lt;doc x=&quot;1&quot;&gt;&lt;x&gt;2&lt;/x&gt;&lt;/doc&gt;&#39; | catmandu convert XML to JSON
{&quot;x&quot;:[&quot;1&quot;,&quot;2&quot;]}</code></pre>
<p>XML attributes can be disabled with option <code>--attributes</code>:</p>
<pre class="cmd"><code>$ echo &#39;&lt;doc x=&quot;1&quot;&gt;&lt;x&gt;2&lt;/x&gt;&lt;/doc&gt;&#39; | catmandu convert XML --attributes 0 to JSON
{&quot;x&quot;:&quot;2&quot;}</code></pre>
</section>
<section class="level4" id="ordered-xml">
<h4><a href="#TOC"><span class="header-section-number">3.1.1.2</span> Ordered XML</a></h4>
<p>The default conversion is not suitable for so called <q>document-oriented</q> XML. Let’s take another example in file <code>doc.xml</code>:</p>
<pre class="cmd"><code>$ cat data/doc.xml
&lt;doc&gt;
  &lt;title&gt;Welcome!&lt;/title&gt;
  &lt;p&gt;
    Look at my &lt;a href=&quot;http://example.org/&quot;&gt;homepage&lt;/a&gt;!
  &lt;/p&gt;
&lt;/doc&gt;</code></pre>
<p>The default conversion ignores mixed content text nodes and element order:</p>
<pre class="cmd"><code>$ catmandu convert XML to JSON --pretty 1 &lt; data/doc.xml
{
   &quot;p&quot; : {
      &quot;a&quot; : {
         &quot;href&quot; : &quot;http://example.org/&quot;
      }
   },
   &quot;title&quot; : &quot;Welcome!&quot;
}</code></pre>
<p>To better support ordered XML, the option <code>--type</code> can be used to select an alternative representation of XML. The YAML exporter is used to better show the imported array structure:</p>
<pre class="cmd"><code>$ catmandu convert XML --type ordered to YAML &lt; data/doc.xml
---
- doc
- {}
- - - title
    - {}
    - - Welcome!
  - - p
    - {}
    - - &quot;\n    Look at my &quot;
      - - a
        - href: http://example.org/
        - - homepage
      - &quot;!\n  &quot;</code></pre>
<p>With <code>--type ordered</code> each XML element is represented as ternary array with element name, attributes, and child elements.</p>
<p>The option <code>--depth</code> can be used to create ordered XML first starting with some nesting level:</p>
<pre class="cmd"><code>$ catmandu convert XML --root doc --depth 2 to YAML &lt; data/doc.xml
---
doc:
  p:
  - - p
    - {}
    - - &quot;\n    Look at my &quot;
      - - a
        - href: http://example.org/
        - - homepage
      - &quot;!\n  &quot;
  title:
  - - title
    - {}
    - - Welcome!</code></pre>
<p>The record fields <code>doc.p</code> and <code>doc.title</code> at level 2 both contain an array of elements just like returned with <code>--type ordered</code>. We can use this structure to access and modify particular fields:</p>
<pre class="cmd"><code>$ catmandu convert XML --root doc --depth 2 --fix &#39;move_field(&quot;doc.title.0.2&quot;,&quot;doc.title&quot;)&#39; to YAML &lt; data/doc.xml
---
doc:
  p:
  - - p
    - {}
    - - &quot;\n    Look at my &quot;
      - - a
        - href: http://example.org/
        - - homepage
      - &quot;!\n  &quot;
  title:
  - Welcome!</code></pre>
</section>
</section>
<section class="level3" id="exporting-xml">
<h3><a href="#TOC"><span class="header-section-number">3.1.2</span> Exporting XML</a></h3>
<p>An XML exporter has not been implemented yet.</p>
</section>
<section class="level3" id="specific-xml-formats">
<h3><a href="#TOC"><span class="header-section-number">3.1.3</span> Specific XML formats</a></h3>
<p>The general XML importer and exporter can be difficult to use for more complex XML formats. For this reason there are specialized importers and exporters for particular XML-based formats.</p>
<p>…e.g. SRU, MODS, PICAXML…</p>
</section>
</section>
</section>
<section class="level1" id="processing-pica-data">
<h1><a href="#TOC"><span class="header-section-number">4</span> Processing PICA data</a></h1>
<p>PICA+ is an internal data format of legacy library automation systems produced by the Dutch company PICA (now aquired by OCLC). The module <a href="https://metacpan.org/module/Catmandu::PICA">Catmandu::PICA</a> provides Catmandu importer, exporter and fixes to work with PICA data.</p>
</section>
<section class="level1" id="acknowledgement">
<h1><a href="#TOC"><span class="header-section-number">5</span> Acknowledgement</a></h1>
<p>…</p>
</section>
</body>
</html>
